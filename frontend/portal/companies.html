<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Companies - TallyConnect</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/utilities.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h1>üìä TallyConnect</h1>
            <p>Report Portal</p>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" href="companies.html">üè¢ Companies</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="reports.html" id="reportsLink" style="display:none;">üìä Reports</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="ledgers.html" id="ledgersLink" style="display:none;">üìó Ledgers</a>
            </li>
        </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="page active">
            <h1 class="page-title">Select Company</h1>
            <div class="company-grid" id="companyGrid">
                <div class="loading">Loading companies...</div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript Files -->
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/export.js"></script>
    <script src="assets/js/utils/filters.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/components/companies.js"></script>
    <script src="assets/js/components/ledgers.js"></script>
    <script src="assets/js/components/ledger-report.js"></script>
    <script src="assets/js/app.js"></script>
    <script>
        // Override selectCompany to navigate to reports.html
        const originalSelectCompany = selectCompany;
        selectCompany = function(company) {
            selectedCompany = company;
            // Store in sessionStorage for cross-page navigation
            sessionStorage.setItem('selectedCompany', JSON.stringify(company));
            // Navigate to reports page
            window.location.href = 'reports.html';
        };
        
        // Override displayCompanies to use new selectCompany
        const originalDisplayCompanies = displayCompanies;
        displayCompanies = function(companies) {
            const grid = document.getElementById('companyGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            console.log(`[Portal] Displaying ${companies.length} companies`);
            
            if (companies.length === 0) {
                grid.innerHTML = '<div class="loading">No companies found.<br><small>Please sync companies in TallyConnect app first.</small></div>';
                return;
            }
            
            companies.forEach((company, index) => {
                console.log(`[Portal] Company ${index + 1}: ${company.name} (GUID: ${company.guid.substring(0, 20)}...)`);
                const card = document.createElement('div');
                card.className = 'company-card';
                card.innerHTML = `
                    <div class="company-name">${company.name}</div>
                    <div class="company-info">
                        Records: ${company.total_records || 0}<br>
                        Status: ${company.status || 'Unknown'}
                    </div>
                `;
                card.onclick = () => selectCompany(company);
                grid.appendChild(card);
            });
        };
        
        // Load companies on page load (override app.js window.onload)
        window.addEventListener('load', function() {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                loadCompanies();
            } else if (typeof COMPANIES_DATA !== 'undefined' && COMPANIES_DATA.length > 0) {
                companiesData = COMPANIES_DATA;
                displayCompanies(companiesData);
            } else {
                loadCompanies();
            }
        });
    </script>
</body>
</html>

